<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ServerSite</title>
    <style>
        .peers button {
            padding: 40px 40px;
            margin: 10px;
            background-color: rgb(195, 195, 195);
            border: 2px solid #000;
            color: rgb(0, 0, 0);
            font-size: 15px;
        }

        .peers {
            display: flex;
            flex-direction: column;
            position: fixed;
            left: 1250px;
        }

        .server button {
            padding: 70px 120px;
            margin: 10px;
            background-color: rgb(195, 195, 195);
            border: 2px solid #000;
            color: rgb(0, 0, 0);
            font-size: 15px;
        }

        .server {
            position: fixed;
            left: 650px;
            top: 250px;
        }

        .client button {
            padding: 60px 40px;
            margin: 10px;
            background-color: rgb(195, 195, 195);
            border: 2px solid #000;
            color: rgb(0, 0, 0);
            font-size: 15px;
        }

        .client {
            position: fixed;
            left: 120px;
            top: 250px;
        }
    </style>
</head>

<body>
</body>
<script>
    let xx = 6
    function httpGetAsync(theUrl, callback) {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.onreadystatechange = function () {
            if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
                callback(xmlHttp.responseText);
        }
        xmlHttp.open("GET", theUrl, true);
        xmlHttp.send(null);
    }
    document.body.setAttribute("onload", "loadServer()")
    peers = document.createElement("div");
    peers.setAttribute("class", "peers");
    document.body.appendChild(peers);
    server = document.createElement("div");
    server.setAttribute("class", "server");
    document.body.appendChild(server);
    client = document.createElement("div");
    client.setAttribute("class", "client");
    document.body.appendChild(client);
    canvas = document.createElement("canvas");
    canvas.setAttribute("id", "c");
    canvas.setAttribute("width", "1500");
    canvas.setAttribute("height", "700");
    document.body.appendChild(canvas);
    for (var i = 1; i <= 6; i++) {
        httpGetAsync(`http://mostafa36a2.pythonanywhere.com/status/peer/in/${i}`, function (response) {
            json_obj = JSON.parse(response);
            console.log(json_obj);
            button1 = document.createElement("button");
            button1.appendChild(document.createTextNode(
                `${json_obj.peer_type}-${json_obj.id}: ${json_obj.state}`
            )
            );
            if (json_obj.state == "connected") {
                button1.classList.add("good_peer")
            } else {
                button1.classList.add("bad_peer")
            }
            button1.setAttribute("title", json_obj.msg)
            div = document.getElementsByTagName("div")[0];
            div.appendChild(button1);
        })
    }
    setTimeout(
        function () {
            for (var t = 0; t < 6; t++) {
                div = document.getElementsByTagName("div")[0];
                peer = div.getElementsByTagName("button")[t];
                peer.setAttribute("onclick", `checkPeer${t + 1}(this)`);
            }
        }, 1000);
    // httpGetAsync(`http://mostafa36a2.pythonanywhere.com/status/peer/out/${i}`, function (response) {
    //     json_obj = JSON.parse(response);
    //     console.log(json_obj);
    //     // button1 = document.createElement("button");
    //     // button1.appendChild(document.createTextNode(
    //     //     `${json_obj.peer_type}-${json_obj.id}: ${json_obj.state}`
    //     // )
    //     // );
    //     if (json_obj.state == "connected") {
    //         button1.classList.add(`${x} good_peer`)
    //     } else {
    //         button1.classList.add(`${x} bad_peer`)
    //     }
    //     // button1.setAttribute("title", json_obj.msg)
    //     div = document.getElementsByTagName("div")[0];
    //     div.appendChild(button1);
    // })
    // }
    httpGetAsync(`http://mostafa36a2.pythonanywhere.com/status/client/in/${i}`, function (response) {
        json_obj = JSON.parse(response);
        console.log(json_obj);
        button3 = document.createElement("button");
        button3.appendChild(document.createTextNode(
            `${json_obj.peer_type}-${json_obj.id}: ${json_obj.state}`
        )
        );
        if (json_obj.state == "connected") {
            button3.classList.add("good_client");
        } else {
            button3.classList.add("bad_client")
        }
        button3.setAttribute("title", json_obj.msg);
        button3.setAttribute("onclick", "checkClient(this)");
        div = document.querySelector(".client");
        div.appendChild(button3);
    })
    function loadServer() {
        button2 = document.createElement("button");
        div = document.getElementsByTagName("div")[1];
        div.appendChild(button2);
        button2.appendChild(document.createTextNode(`Server`))
    }
    canvas = document.getElementById("c").getContext("2d");
    function canvas_arrow(context, fromX, fromY, toX, toY, color) {
        canvas.beginPath();
        var headLen = 15; // length of head in pixels
        var dx = toX - fromX;
        var dy = toY - fromY;
        var angle = Math.atan2(dy, dx);
        context.moveTo(fromX, fromY);
        context.lineTo(toX, toY);
        context.lineTo(toX - headLen * Math.cos(angle - Math.PI / 6), toY - headLen * Math.sin(angle - Math.PI / 6));
        context.moveTo(toX, toY);
        context.lineTo(toX - headLen * Math.cos(angle + Math.PI / 6), toY - headLen * Math.sin(angle + Math.PI / 6));
        context.strokeStyle = color;
        context.save();
        canvas.stroke();
    }
    function checkClient(e) {
        if (json_obj.direction == 'in') {
            if (e.className === 'good_client') {
                canvas_arrow(canvas, 330, 290, 650, 290, "green");
            } else if (e.className === 'bad_client') {
                canvas_arrow(canvas, 330, 290, 650, 290, "red");
            } else {
                canvas_arrow(canvas, 330, 290, 650, 290, "gray");
            }
        }
        else if (json_obj.direction == 'out') {
            if (e.className === 'good_client') {
                canvas_arrow(canvas, 650, 330, 330, 330, "green");
            } else if (e.className === 'bad_client') {
                canvas_arrow(canvas, 650, 330, 330, 330, "red");
            } else {
                canvas_arrow(canvas, 650, 330, 330, 330, "gray");
            }
        }
        else {
            window.alert("Not found");
        }
        setTimeout(
            function () {
                canvas.clearRect(0, 0, 1500, 700);
            }, 2000);
    }
    function checkPeer1(e) {
        for (var i = 0; i < 6; i++) {
            if (json_obj.direction == 'in') {
                if (e.className === 'good_peer') {
                    canvas_arrow(canvas, 928, 290, 1250, 36, "green");
                } else if (e.className === 'bad_peer') {
                    canvas_arrow(canvas, 928, 290, 1250, 36, "red");
                } else {
                    canvas_arrow(canvas, 928, 290, 1250, 36, "gray");
                }
            }
            else if (json_obj.direction == 'out') {
                if (e.className === 'good_peer') {
                    canvas_arrow(canvas, 1250, 80, 942, 360, "green");
                } else if (e.className === 'bad_peer') {
                    canvas_arrow(canvas, 1250, 80, 942, 360, "red");
                } else {
                    canvas_arrow(canvas, 1250, 80, 942, 360, "gray");
                }
            }
            else {
                window.alert("Not found");
            }
            setTimeout(
                function () {
                    canvas.clearRect(0, 0, 1500, 700);
                }, 2000);
        }
    }
    function checkPeer2(e) {
        for (var i = 0; i < 6; i++) {
            if (json_obj.direction == 'in') {
                if (e.className === 'good_peer') {
                    canvas_arrow(canvas, 928, 290, 1250, 170, "green");
                } else if (e.className === 'bad_peer') {
                    canvas_arrow(canvas, 928, 290, 1250, 170, "red");
                } else {
                    canvas_arrow(canvas, 928, 290, 1250, 170, "gray");
                }
            }
            else if (json_obj.direction == 'out') {
                if (e.className === 'good_peer') {
                    canvas_arrow(canvas, 1250, 230, 942, 360, "green");
                } else if (e.className === 'bad_peer') {
                    canvas_arrow(canvas, 1250, 230, 942, 360, "red");
                } else {
                    canvas_arrow(canvas, 1250, 230, 942, 360, "gray");
                }
            }
            else {
                window.alert("Not found");
            }
            setTimeout(
                function () {
                    canvas.clearRect(0, 0, 1500, 700);
                }, 2000);
        }
    }
    function checkPeer3(e) {
        for (var i = 0; i < 6; i++) {
            if (json_obj.direction == 'in') {
                if (e.className === 'good_peer') {
                    canvas_arrow(canvas, 928, 290, 1250, 300, "green");
                } else if (e.className === 'bad_peer') {
                    canvas_arrow(canvas, 928, 290, 1250, 300, "red");
                } else {
                    canvas_arrow(canvas, 928, 290, 1250, 300, "gray");
                }
            }
            else if (json_obj.direction == 'out') {
                if (e.className === 'good_peer') {
                    canvas_arrow(canvas, 1250, 340, 942, 360, "green");
                } else if (e.className === 'bad_peer') {
                    canvas_arrow(canvas, 1250, 340, 942, 360, "red");
                } else {
                    canvas_arrow(canvas, 1250, 340, 942, 360, "gray");
                }
            }
            else {
                window.alert("Not found");
            }
            setTimeout(
                function () {
                    canvas.clearRect(0, 0, 1500, 700);
                }, 2000);
        }
    }
    function checkPeer4(e) {
        for (var i = 0; i < 6; i++) {
            if (json_obj.direction == 'iin') {
                if (e.className === 'good_peer') {
                    canvas_arrow(canvas, 928, 290, 1250, 400, "green");
                } else if (e.className === 'bad_peer') {
                    canvas_arrow(canvas, 928, 290, 1250, 400, "red");
                } else {
                    canvas_arrow(canvas, 928, 290, 1250, 400, "gray");
                }
            }
            else if (json_obj.direction == 'in') {
                if (e.className === 'good_peer') {
                    canvas_arrow(canvas, 1250, 450, 942, 360, "green");
                } else if (e.className === 'bad_peer') {
                    canvas_arrow(canvas, 1250, 450, 942, 360, "red");
                } else {
                    canvas_arrow(canvas, 1250, 450, 942, 360, "gray");
                }
            }
            else {
                window.alert("Not found");
            }
            setTimeout(
                function () {
                    canvas.clearRect(0, 0, 1500, 700);
                }, 2000);
        }
    }
    function checkPeer5(e) {
        for (var i = 0; i < 6; i++) {
            if (json_obj.direction == 'in') {
                if (e.className === 'good_peer') {
                    canvas_arrow(canvas, 928, 290, 1250, 510, "green");
                } else if (e.className === 'bad_peer') {
                    canvas_arrow(canvas, 928, 290, 1250, 510, "red");
                } else {
                    canvas_arrow(canvas, 928, 290, 1250, 510, "gray");
                }
            }
            else if (json_obj.direction == 'out') {
                if (e.className === 'good_peer') {
                    canvas_arrow(canvas, 1250, 560, 942, 360, "green");
                } else if (e.className === 'bad_peer') {
                    canvas_arrow(canvas, 1250, 560, 942, 360, "red");
                } else {
                    canvas_arrow(canvas, 1250, 560, 942, 360, "gray");
                }
            }
            else {
                window.alert("Not found");
            }
            setTimeout(
                function () {
                    canvas.clearRect(0, 0, 1500, 700);
                }, 2000);
        }
    }
    function checkPeer6(e) {
        for (var i = 0; i < 6; i++) {
            if (json_obj.direction == 'in') {
                if (e.className === 'good_peer') {
                    canvas_arrow(canvas, 928, 290, 1250, 630, "green");
                } else if (e.className === 'bad_peer') {
                    canvas_arrow(canvas, 928, 290, 1250, 630, "red");
                } else {
                    canvas_arrow(canvas, 928, 290, 1250, 630, "gray");
                }
            }
            else if (json_obj.direction == 'out') {
                if (e.className === 'good_peer') {
                    canvas_arrow(canvas, 1250, 680, 942, 360, "green");
                } else if (e.className === 'bad_peer') {
                    canvas_arrow(canvas, 1250, 680, 942, 360, "red");
                } else {
                    canvas_arrow(canvas, 1250, 680, 942, 360, "gray");
                }
            }
            else {
                window.alert("Not found");
            }
            setTimeout(
                function () {
                    canvas.clearRect(0, 0, 1500, 700);
                }, 2000);
        }
    }
</script>

</html>